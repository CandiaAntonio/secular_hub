(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41],{374:function(e,t,s){Promise.resolve().then(s.bind(s,6409))},6409:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return B}});var n=s(7437),r=s(2265),a=s(2869),l=s(6070),i=s(4508);function o(e){let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,i.cn)("animate-pulse rounded-md bg-muted",t),...s})}var c=s(7168),d=s(8867);function u(){let{summary:e,loading:t,regenerate:s}=function(){let{initialAutoFetch:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,s]=(0,r.useState)(null),[n,a]=(0,r.useState)(!1),[l,i]=(0,r.useState)(null),o=(0,r.useCallback)(async()=>{a(!0),i(null);try{let e=await fetch("/api/ai/summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:"Generate a concise executive summary of the consensus application for 2026, highlighting key themes like inflation, growth, and monetary policy. Limit to 150 words.",context:"snapshot_2026"})});if(!e.ok)throw Error("Failed to generate summary");let t=await e.json();s(t.summary||t.result||t.text||"Summary generated.")}catch(e){console.error(e),i("Failed to load AI summary")}finally{a(!1)}},[]);return(0,r.useEffect)(()=>{e&&o()},[o,e]),{summary:t,loading:n,error:l,regenerate:o}}();return(0,n.jsxs)(l.Zb,{className:"border-l-4 border-l-primary/50 relative overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10 bg-[url('/grid-pattern.svg')] w-full h-full pointer-events-none"}),(0,n.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsxs)(l.ll,{className:"text-lg font-medium flex items-center",children:[(0,n.jsx)("span",{className:"mr-2",children:"\uD83D\uDCDD"})," AI API Consensus Summary"]}),(0,n.jsxs)("div",{className:"flex space-x-2 z-10",children:[(0,n.jsx)(a.z,{variant:"ghost",size:"icon",onClick:s,disabled:t,title:"Regenerate",children:(0,n.jsx)(c.Z,{className:"h-4 w-4 ".concat(t?"animate-spin":"")})}),(0,n.jsx)(a.z,{variant:"ghost",size:"icon",onClick:()=>{e&&navigator.clipboard.writeText(e)},disabled:!e,title:"Copy",children:(0,n.jsx)(d.Z,{className:"h-4 w-4"})})]})]}),(0,n.jsxs)(l.aY,{children:[t?(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(o,{className:"h-4 w-full"}),(0,n.jsx)(o,{className:"h-4 w-[90%]"}),(0,n.jsx)(o,{className:"h-4 w-[80%]"})]}):(0,n.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none text-muted-foreground",children:(0,n.jsxs)("p",{className:"italic",children:['"',e||"No summary available. Click regenerate to create one.",'"']})}),(0,n.jsx)("div",{className:"mt-4 text-xs text-muted-foreground border-t pt-2",children:"* This summary is AI-generated from Bloomberg's editorial compilation."})]})]})}var m=s(3056),x=s(2575),f=s(8155);let h=e=>{let{root:t,depth:s,x:r,y:a,width:l,height:i,index:o,payload:c,colors:d,rank:u,name:m,value:x,onThemeClick:f}=e;return(0,n.jsxs)("g",{children:[(0,n.jsx)("rect",{x:r,y:a,width:l,height:i,style:{fill:"#3b82f6",fillOpacity:.1+x/(t.value||1)*.9,stroke:"#fff",strokeWidth:2/(s+1e-10),strokeOpacity:1/(s+1e-10)},className:"cursor-pointer hover:fill-blue-400 transition-colors",onClick:()=>f&&f(m)}),l>50&&i>30&&(0,n.jsx)("text",{x:r+l/2,y:a+i/2,textAnchor:"middle",fill:"#fff",fontSize:Math.min(l/5,14),className:"pointer-events-none font-medium select-none drop-shadow-md",children:m}),l>50&&i>50&&(0,n.jsx)("text",{x:r+l/2,y:a+i/2+16,textAnchor:"middle",fill:"#fff",fontSize:10,className:"pointer-events-none select-none drop-shadow-md opacity-80",children:x})]})};function p(e){let{data:t,onThemeClick:s,className:r,title:a}=e,o=[{name:"Themes",children:t.map(e=>({name:e.theme,value:e.count}))}];return(0,n.jsxs)(l.Zb,{className:(0,i.cn)("flex flex-col",r),children:[a&&(0,n.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between pb-2",children:[(0,n.jsx)(l.ll,{className:"text-lg font-medium",children:a}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Click blocks for details"})]}),(0,n.jsx)(l.aY,{className:"flex-1 min-h-[400px]",children:t.length>0?(0,n.jsx)(m.h,{width:"100%",height:"100%",children:(0,n.jsx)(x.WB,{data:o,dataKey:"value",stroke:"#fff",fill:"#8884d8",content:(0,n.jsx)(h,{onThemeClick:s}),children:(0,n.jsx)(f.u,{content:e=>{let{active:t,payload:s}=e;if(t&&s&&s.length){let e=s[0].payload;return(0,n.jsxs)("div",{className:"bg-popover text-popover-foreground p-2 rounded shadow border text-sm",children:[(0,n.jsx)("p",{className:"font-semibold",children:e.name}),(0,n.jsxs)("p",{children:[e.value," calls"]})]})}return null}})})}):(0,n.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No theme data available"})})]})}var g=s(1145),v=s(1721),j=s(407),N=s(3250);let b={Bullish:"#10b981",Bearish:"#ef4444",Neutral:"#6b7280",Mixed:"#f59e0b"};function y(e){let{data:t,title:s,className:r}=e;t.reduce((e,t)=>e+t.value,0);let a=[...t].sort((e,t)=>t.value-e.value)[0];return(0,n.jsxs)(l.Zb,{className:(0,i.cn)("flex flex-col",r),children:[s&&(0,n.jsx)(l.Ol,{className:"pb-2",children:(0,n.jsx)(l.ll,{className:"text-base font-medium",children:s})}),(0,n.jsxs)(l.aY,{className:"flex-1 min-h-[250px] relative",children:[(0,n.jsx)(m.h,{width:"100%",height:"100%",children:(0,n.jsxs)(g.u,{children:[(0,n.jsx)(v.by,{data:t,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:2,dataKey:"value",children:t.map((e,t)=>(0,n.jsx)(j.b,{fill:b[e.name]||"#8884d8",strokeWidth:0},"cell-".concat(t)))}),(0,n.jsx)(f.u,{formatter:e=>["".concat(e||0," calls"),"Count"],contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),(0,n.jsx)(N.D,{verticalAlign:"bottom",height:36,iconType:"circle"})]})}),(0,n.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none pb-8",children:[(0,n.jsx)("span",{className:"text-2xl font-bold",children:(null==a?void 0:a.name)||"N/A"}),(0,n.jsx)("span",{className:"text-xs text-muted-foreground",children:"Dominant"})]})]})]})}var w=s(5974);function k(e){let{institutions:t,className:s,onSelect:r,selectedInstitution:a}=e,l=[...t].sort((e,t)=>t.count-e.count);return(0,n.jsxs)("div",{className:(0,i.cn)("w-full space-y-3",s),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-muted-foreground",children:"INSTITUTION COVERAGE"}),(0,n.jsxs)("span",{className:"text-xs text-muted-foreground",children:[t.length," Firms"]})]}),(0,n.jsx)("div",{className:"relative w-full overflow-hidden rounded-md border bg-background p-4",children:(0,n.jsxs)("div",{className:"flex w-full space-x-4 overflow-x-auto pb-4 scrollbar-hide",children:[l.map(e=>(0,n.jsx)("button",{onClick:()=>null==r?void 0:r(a===e.institution?null:e.institution),className:"flex-shrink-0 group",children:(0,n.jsxs)("div",{className:(0,i.cn)("flex flex-col items-center justify-center p-3 rounded-lg border transition-all min-w-[120px]",a===e.institution?"border-primary bg-primary/10":"border-muted hover:border-primary/50"),children:[(0,n.jsx)("span",{className:(0,i.cn)("font-semibold text-sm whitespace-nowrap",e.count>10?"text-primary":"text-foreground"),children:e.institution}),(0,n.jsxs)(w.C,{variant:"secondary",className:"mt-2 text-xs",children:[e.count," calls"]})]})},e.institution)),0===l.length&&(0,n.jsx)("div",{className:"text-sm text-muted-foreground p-4",children:"No institutions found."})]})})]})}var C=s(4887),S=s(2489),T=s(2135),E=s(875);function Z(e){let{call:t,className:s}=e,[a,o]=(0,r.useState)(!1);return(0,n.jsx)(l.Zb,{className:(0,i.cn)("overflow-hidden",s),children:(0,n.jsxs)(l.aY,{className:"p-4 space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"font-semibold text-sm",children:t.institution}),(0,n.jsx)(w.C,{variant:"outline",className:(0,i.cn)("text-xs","High"===t.convictionTier?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100":"Medium"===t.convictionTier?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100"),children:t.convictionTier||"Neutral"})]}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground",children:[t.themeCategory&&(0,n.jsxs)("span",{className:"font-medium text-foreground",children:[t.themeCategory,": "]}),a?t.callText:(0,n.jsx)("span",{className:"line-clamp-2",children:t.callText})]}),(0,n.jsx)("button",{onClick:()=>o(!a),className:"flex items-center text-xs text-primary hover:underline mt-1",children:a?(0,n.jsxs)(n.Fragment,{children:["Show Less ",(0,n.jsx)(T.Z,{className:"h-3 w-3 ml-1"})]}):(0,n.jsxs)(n.Fragment,{children:["Read More ",(0,n.jsx)(E.Z,{className:"h-3 w-3 ml-1"})]})})]})})}function R(e){let{isOpen:t,onClose:s,theme:l,calls:i}=e,o=(0,r.useRef)(null);return((0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&s()};return t&&window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,s]),(0,r.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t)?(0,C.createPortal)((0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:(0,n.jsxs)("div",{ref:o,className:"bg-background rounded-lg shadow-lg w-full max-w-3xl max-h-[85vh] flex flex-col animate-in zoom-in-95 duration-200 border",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:l}),(0,n.jsxs)("p",{className:"text-muted-foreground text-sm",children:[i.length," relevant outlooks"]})]}),(0,n.jsx)(a.z,{variant:"ghost",size:"icon",onClick:s,children:(0,n.jsx)(S.Z,{className:"h-4 w-4"})})]}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:i.length>0?i.map(e=>(0,n.jsx)(Z,{call:e},e.id)):(0,n.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:"No specific calls found for this theme."})})]})}),document.body):null}var z=s(265),O=s(5051),A=s(6858);function F(e){let{title:t,value:s,change:r,icon:a,className:o}=e;return(0,n.jsx)(l.Zb,{className:(0,i.cn)(o),children:(0,n.jsxs)(l.aY,{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,n.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,n.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:t}),(0,n.jsx)("span",{className:"text-2xl font-bold",children:s})]}),a&&(0,n.jsx)("div",{className:"text-muted-foreground",children:a})]}),r&&(0,n.jsxs)("div",{className:"mt-4 flex items-center text-sm",children:["up"===r.direction&&(0,n.jsx)(z.Z,{className:"mr-1 h-4 w-4 text-success"}),"down"===r.direction&&(0,n.jsx)(O.Z,{className:"mr-1 h-4 w-4 text-destructive"}),"flat"===r.direction&&(0,n.jsx)(A.Z,{className:"mr-1 h-4 w-4 text-warning"}),(0,n.jsxs)("span",{className:(0,i.cn)("up"===r.direction&&"text-success","down"===r.direction&&"text-destructive","flat"===r.direction&&"text-warning"),children:[Math.abs(r.value),"%"]}),(0,n.jsx)("span",{className:"ml-2 text-muted-foreground",children:"vs last year"})]})]})})}var D=s(8736),I=s(8420);function _(){return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(o,{className:"h-8 w-[200px]"}),(0,n.jsx)(o,{className:"h-[150px] w-full"})]}),(0,n.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,n.jsx)(o,{className:"h-[120px]"}),(0,n.jsx)(o,{className:"h-[120px]"}),(0,n.jsx)(o,{className:"h-[120px]"})]}),(0,n.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[(0,n.jsx)(o,{className:"col-span-2 h-[400px]"}),(0,n.jsx)(o,{className:"h-[400px]"})]})]})}function B(){var e;let{themes:t,institutions:s,outlooks:a,stats:l,loading:i,error:o}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2026,[t,s]=(0,r.useState)({themes:[],institutions:[],outlooks:[],stats:null,loading:!0,error:null});return(0,r.useEffect)(()=>{(async()=>{try{var t;s(e=>({...e,loading:!0,error:null}));let n=await fetch("/api/stats/themes?year=".concat(e));if(!n.ok)throw Error("Failed to fetch theme stats");let r=await n.json(),a=await fetch("/api/stats/institutions?year=".concat(e));if(!a.ok)throw Error("Failed to fetch institution stats");let l=await a.json(),i=await fetch("/api/outlooks?year=".concat(e,"&limit=50"));if(!i.ok)throw Error("Failed to fetch outlooks");let o=await i.json();s({themes:r||[],institutions:l||[],outlooks:o.data||[],stats:{total_records:(null===(t=o.pagination)||void 0===t?void 0:t.total)||0,years:[],themes:r||[],institutions:l||[]},loading:!1,error:null})}catch(e){console.error("Snapshot data fetch error:",e),s(t=>({...t,loading:!1,error:e.message}))}})()},[e]),t}(2026),[c,d]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[f,h]=(0,r.useState)([]),[g,v]=(0,r.useState)(!1),j=(0,r.useMemo)(()=>(a.forEach(e=>{if(!e)return}),[{name:"Bullish",value:45},{name:"Bearish",value:25},{name:"Neutral",value:20},{name:"Mixed",value:10}]),[a]),N=async e=>{x(e),v(!0);try{let t=new URLSearchParams({year:"2026",theme:e,limit:"20"});c&&t.append("institution",c);let s=await fetch("/api/outlooks?".concat(t.toString())),n=await s.json();h(n.data||[])}catch(e){console.error("Failed to fetch theme details",e),h([])}finally{v(!1)}};return i?(0,n.jsx)(_,{}):o?(0,n.jsxs)("div",{className:"p-8 text-destructive",children:["Error loading snapshot: ",o]}):(0,n.jsxs)("div",{className:"space-y-6 animate-in fade-in duration-500",children:[(0,n.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,n.jsx)("div",{className:"lg:col-span-2",children:(0,n.jsx)(u,{})}),(0,n.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-1",children:[(0,n.jsx)(F,{title:"Total Calls",value:(null==l?void 0:l.total_records)||0,change:{value:26,direction:"up"},icon:(0,n.jsx)(D.Z,{className:"h-4 w-4 text-muted-foreground"})}),(0,n.jsx)(F,{title:"Institutions",value:(null==l?void 0:null===(e=l.institutions)||void 0===e?void 0:e.length)||0,change:{value:12,direction:"up"},icon:(0,n.jsx)(I.Z,{className:"h-4 w-4 text-muted-foreground"})})]})]}),(0,n.jsxs)("div",{className:"grid gap-6 md:grid-cols-3",children:[(0,n.jsx)("div",{className:"md:col-span-2",children:(0,n.jsx)(p,{title:"Theme Hierarchy",data:t,onThemeClick:N,className:"h-full"})}),(0,n.jsx)("div",{className:"md:col-span-1",children:(0,n.jsx)(y,{title:"Sentiment Distribution",data:j,className:"h-full"})})]}),(0,n.jsx)("div",{children:(0,n.jsx)(k,{institutions:s,onSelect:e=>{d(e)},selectedInstitution:c})}),m&&(0,n.jsx)(R,{isOpen:!!m,onClose:()=>x(null),theme:m,calls:f})]})}},5974:function(e,t,s){"use strict";s.d(t,{C:function(){return i}});var n=s(7437);s(2265);var r=s(535),a=s(4508);let l=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...r}=e;return(0,n.jsx)("div",{className:(0,a.cn)(l({variant:s}),t),...r})}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var n=s(7437),r=s(2265),a=s(7053),l=s(535),i=s(4508);let o=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,variant:r,size:l,asChild:c=!1,...d}=e,u=c?a.g7:"button";return(0,n.jsx)(u,{className:(0,i.cn)(o({variant:r,size:l,className:s})),ref:t,...d})});c.displayName="Button"},6070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},Zb:function(){return l},aY:function(){return c},ll:function(){return o}});var n=s(7437),r=s(2265),a=s(4508);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});l.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...r})});i.displayName="CardHeader";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});o.displayName="CardTitle",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",s),...r})}).displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",s),...r})});c.displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter"},4508:function(e,t,s){"use strict";s.d(t,{cn:function(){return a}});var n=s(1994),r=s(3335);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,n.W)(t))}}},function(e){e.O(0,[203,83,471,971,117,744],function(){return e(e.s=374)}),_N_E=e.O()}]);