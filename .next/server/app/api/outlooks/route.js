"use strict";(()=>{var e={};e.id=860,e.ids=[860],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3973:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>h,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>y});var a={};o.r(a),o.d(a,{GET:()=>u});var n=o(9303),r=o(8716),i=o(670),l=o(7070),s=o(3697);async function u(e){try{let t=e.nextUrl.searchParams,o=t.get("year")?parseInt(t.get("year")):void 0,a=t.get("institution")||void 0,n=t.get("theme")||void 0,r=t.get("theme_category")||void 0,i=t.get("conviction")||void 0,u=t.get("limit")?parseInt(t.get("limit")):50,c=t.get("page")?parseInt(t.get("page")):1,p=t.get("search")||void 0,y=await (0,s._)({year:o,institution:a,theme:n,themeCategory:r,conviction:i,limit:u,page:c,search:p});return l.NextResponse.json({data:y.data,pagination:{total:y.total,page:y.page,limit:y.limit},filters_applied:{year:o,institution:a,theme:n,themeCategory:r,conviction:i,search:p}})}catch(e){return console.error("API Error:",e),l.NextResponse.json({error:"Internal Server Error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/outlooks/route",pathname:"/api/outlooks",filename:"route",bundlePath:"app/api/outlooks/route"},resolvedPagePath:"C:\\1 Projects\\secular_forum\\secular_hub\\app\\api\\outlooks\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:y,serverHooks:g}=c,h="/api/outlooks/route";function m(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:y})}},3697:(e,t,o)=>{o.d(t,{cT:()=>s,Wr:()=>i,_:()=>r,fy:()=>l});let a=require("@prisma/client"),n=global.prisma||new a.PrismaClient({log:["query"]});async function r(e){let{year:t,institution:o,theme:a,themeCategory:r,conviction:i,limit:l=50,page:s=1,search:u}=e,c={};t&&(c.year=t),o&&(c.institution={contains:o}),a&&(c.theme={contains:a}),r&&(c.themeCategory=r),i&&(c.convictionTier=i),u&&(c.OR=[{callText:{contains:u}},{theme:{contains:u}},{institution:{contains:u}}]);let[p,y]=await Promise.all([n.outlookCall.findMany({where:c,take:l,skip:(s-1)*l,orderBy:{id:"asc"}}),n.outlookCall.count({where:c})]);return{data:p,total:y,page:s,limit:l}}async function i(e){return n.outlookCall.findUnique({where:{id:e}})}async function l(){let[e,t,o,a]=await Promise.all([n.outlookCall.count(),n.outlookCall.groupBy({by:["year"],_count:{_all:!0},orderBy:{year:"desc"}}),n.outlookCall.groupBy({by:["themeCategory"],_count:{_all:!0},orderBy:{_count:{_all:"desc"}}}),n.outlookCall.groupBy({by:["institutionCanonical"],_count:{_all:!0},orderBy:{_count:{_all:"desc"}}})]);return{total_records:e,years:t.map(e=>({year:e.year,count:e._count?._all||0})),themes:o.map(e=>({theme:e.themeCategory,count:e._count?._all||0})),institutions:a.map(e=>({institution:e.institutionCanonical,count:e._count?._all||0}))}}async function s(e,t){let[o,a,r,i]=await Promise.all([n.outlookCall.groupBy({by:["themeCategory"],where:{year:e},_count:{_all:!0}}),n.outlookCall.groupBy({by:["themeCategory"],where:{year:t},_count:{_all:!0}}),n.outlookCall.groupBy({by:["institutionCanonical","themeCategory"],where:{year:e}}),n.outlookCall.groupBy({by:["institutionCanonical","themeCategory"],where:{year:t}})]),l=new Map(o.map(e=>[e.themeCategory,e._count?._all||0])),s=new Map(a.map(e=>[e.themeCategory,e._count?._all||0])),u=new Set([...l.keys(),...s.keys()]),c=[],p=[],y=[],g=[];u.forEach(e=>{let t=l.get(e)||0,o=s.get(e)||0,a=o-t;0===t&&o>0?c.push(e):t>0&&0===o?p.push(e):a>0?y.push({theme:e,delta:a}):a<0&&g.push({theme:e,delta:a})});let h=new Map;r.forEach(e=>{let t=h.get(e.institutionCanonical)||[];t.push(e.themeCategory),h.set(e.institutionCanonical,t)});let m=new Map;i.forEach(e=>{let t=m.get(e.institutionCanonical)||[];t.push(e.themeCategory),m.set(e.institutionCanonical,t)});let d=[];for(let e of new Set([...h.keys(),...m.keys()])){let t=h.get(e)||[],o=m.get(e)||[];d.push({institution:e,year1_themes:t,year2_themes:o})}return{year1:e,year2:t,themes_emerged:c,themes_extinct:p,themes_grew:y.sort((e,t)=>t.delta-e.delta),themes_declined:g.sort((e,t)=>e.delta-t.delta),institutional_changes:d.slice(0,50)}}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),a=t.X(0,[276,972],()=>o(3973));module.exports=a})();