"use strict";(()=>{var t={};t.id=961,t.ids=[961],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},942:(t,e,o)=>{o.r(e),o.d(e,{originalPathname:()=>m,patchFetch:()=>d,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var a={};o.r(a),o.d(a,{GET:()=>u});var n=o(9303),r=o(8716),l=o(670),i=o(7070),s=o(3697);async function u(){try{let t=await (0,s.fy)();return i.NextResponse.json(t)}catch(t){return console.error("API Error:",t),i.NextResponse.json({error:"Internal Server Error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/stats/route",pathname:"/api/stats",filename:"route",bundlePath:"app/api/stats/route"},resolvedPagePath:"C:\\1 Projects\\secular_forum\\secular_hub\\app\\api\\stats\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:y,serverHooks:h}=c,m="/api/stats/route";function d(){return(0,l.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},3697:(t,e,o)=>{o.d(e,{cT:()=>s,Wr:()=>l,_:()=>r,fy:()=>i});let a=require("@prisma/client"),n=global.prisma||new a.PrismaClient({log:["query"]});async function r(t){let{year:e,institution:o,theme:a,themeCategory:r,conviction:l,limit:i=50,page:s=1,search:u}=t,c={};e&&(c.year=e),o&&(c.institution={contains:o}),a&&(c.theme={contains:a}),r&&(c.themeCategory=r),l&&(c.convictionTier=l),u&&(c.OR=[{callText:{contains:u}},{theme:{contains:u}},{institution:{contains:u}}]);let[p,y]=await Promise.all([n.outlookCall.findMany({where:c,take:i,skip:(s-1)*i,orderBy:{id:"asc"}}),n.outlookCall.count({where:c})]);return{data:p,total:y,page:s,limit:i}}async function l(t){return n.outlookCall.findUnique({where:{id:t}})}async function i(){let[t,e,o,a]=await Promise.all([n.outlookCall.count(),n.outlookCall.groupBy({by:["year"],_count:{_all:!0},orderBy:{year:"desc"}}),n.outlookCall.groupBy({by:["themeCategory"],_count:{_all:!0},orderBy:{_count:{_all:"desc"}}}),n.outlookCall.groupBy({by:["institutionCanonical"],_count:{_all:!0},orderBy:{_count:{_all:"desc"}}})]);return{total_records:t,years:e.map(t=>({year:t.year,count:t._count?._all||0})),themes:o.map(t=>({theme:t.themeCategory,count:t._count?._all||0})),institutions:a.map(t=>({institution:t.institutionCanonical,count:t._count?._all||0}))}}async function s(t,e){let[o,a,r,l]=await Promise.all([n.outlookCall.groupBy({by:["themeCategory"],where:{year:t},_count:{_all:!0}}),n.outlookCall.groupBy({by:["themeCategory"],where:{year:e},_count:{_all:!0}}),n.outlookCall.groupBy({by:["institutionCanonical","themeCategory"],where:{year:t}}),n.outlookCall.groupBy({by:["institutionCanonical","themeCategory"],where:{year:e}})]),i=new Map(o.map(t=>[t.themeCategory,t._count?._all||0])),s=new Map(a.map(t=>[t.themeCategory,t._count?._all||0])),u=new Set([...i.keys(),...s.keys()]),c=[],p=[],y=[],h=[];u.forEach(t=>{let e=i.get(t)||0,o=s.get(t)||0,a=o-e;0===e&&o>0?c.push(t):e>0&&0===o?p.push(t):a>0?y.push({theme:t,delta:a}):a<0&&h.push({theme:t,delta:a})});let m=new Map;r.forEach(t=>{let e=m.get(t.institutionCanonical)||[];e.push(t.themeCategory),m.set(t.institutionCanonical,e)});let d=new Map;l.forEach(t=>{let e=d.get(t.institutionCanonical)||[];e.push(t.themeCategory),d.set(t.institutionCanonical,e)});let g=[];for(let t of new Set([...m.keys(),...d.keys()])){let e=m.get(t)||[],o=d.get(t)||[];g.push({institution:t,year1_themes:e,year2_themes:o})}return{year1:t,year2:e,themes_emerged:c,themes_extinct:p,themes_grew:y.sort((t,e)=>e.delta-t.delta),themes_declined:h.sort((t,e)=>t.delta-e.delta),institutional_changes:g.slice(0,50)}}}};var e=require("../../../webpack-runtime.js");e.C(t);var o=t=>e(e.s=t),a=e.X(0,[276,972],()=>o(942));module.exports=a})();