"use strict";(()=>{var e={};e.id=391,e.ids=[391],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1933:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>d,requestAsyncStorage:()=>y,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p});var o={};a.r(o),a.d(o,{GET:()=>u});var n=a(9303),r=a(8716),l=a(670),i=a(7070),s=a(3697);async function u(){let e=await (0,s.fy)();return i.NextResponse.json(e.years)}let c=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/stats/years/route",pathname:"/api/stats/years",filename:"route",bundlePath:"app/api/stats/years/route"},resolvedPagePath:"C:\\1 Projects\\secular_forum\\secular_hub\\app\\api\\stats\\years\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:p,serverHooks:h}=c,m="/api/stats/years/route";function d(){return(0,l.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}},3697:(e,t,a)=>{a.d(t,{cT:()=>s,Wr:()=>l,_:()=>r,fy:()=>i});let o=require("@prisma/client"),n=global.prisma||new o.PrismaClient({log:["query"]});async function r(e){let{year:t,institution:a,theme:o,themeCategory:r,conviction:l,limit:i=50,page:s=1,search:u}=e,c={};t&&(c.year=t),a&&(c.institution={contains:a}),o&&(c.theme={contains:o}),r&&(c.themeCategory=r),l&&(c.convictionTier=l),u&&(c.OR=[{callText:{contains:u}},{theme:{contains:u}},{institution:{contains:u}}]);let[y,p]=await Promise.all([n.outlookCall.findMany({where:c,take:i,skip:(s-1)*i,orderBy:{id:"asc"}}),n.outlookCall.count({where:c})]);return{data:y,total:p,page:s,limit:i}}async function l(e){return n.outlookCall.findUnique({where:{id:e}})}async function i(){let[e,t,a,o]=await Promise.all([n.outlookCall.count(),n.outlookCall.groupBy({by:["year"],_count:{_all:!0},orderBy:{year:"desc"}}),n.outlookCall.groupBy({by:["themeCategory"],_count:{_all:!0},orderBy:{_count:{_all:"desc"}}}),n.outlookCall.groupBy({by:["institutionCanonical"],_count:{_all:!0},orderBy:{_count:{_all:"desc"}}})]);return{total_records:e,years:t.map(e=>({year:e.year,count:e._count?._all||0})),themes:a.map(e=>({theme:e.themeCategory,count:e._count?._all||0})),institutions:o.map(e=>({institution:e.institutionCanonical,count:e._count?._all||0}))}}async function s(e,t){let[a,o,r,l]=await Promise.all([n.outlookCall.groupBy({by:["themeCategory"],where:{year:e},_count:{_all:!0}}),n.outlookCall.groupBy({by:["themeCategory"],where:{year:t},_count:{_all:!0}}),n.outlookCall.groupBy({by:["institutionCanonical","themeCategory"],where:{year:e}}),n.outlookCall.groupBy({by:["institutionCanonical","themeCategory"],where:{year:t}})]),i=new Map(a.map(e=>[e.themeCategory,e._count?._all||0])),s=new Map(o.map(e=>[e.themeCategory,e._count?._all||0])),u=new Set([...i.keys(),...s.keys()]),c=[],y=[],p=[],h=[];u.forEach(e=>{let t=i.get(e)||0,a=s.get(e)||0,o=a-t;0===t&&a>0?c.push(e):t>0&&0===a?y.push(e):o>0?p.push({theme:e,delta:o}):o<0&&h.push({theme:e,delta:o})});let m=new Map;r.forEach(e=>{let t=m.get(e.institutionCanonical)||[];t.push(e.themeCategory),m.set(e.institutionCanonical,t)});let d=new Map;l.forEach(e=>{let t=d.get(e.institutionCanonical)||[];t.push(e.themeCategory),d.set(e.institutionCanonical,t)});let g=[];for(let e of new Set([...m.keys(),...d.keys()])){let t=m.get(e)||[],a=d.get(e)||[];g.push({institution:e,year1_themes:t,year2_themes:a})}return{year1:e,year2:t,themes_emerged:c,themes_extinct:y,themes_grew:p.sort((e,t)=>t.delta-e.delta),themes_declined:h.sort((e,t)=>e.delta-t.delta),institutional_changes:g.slice(0,50)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[276,972],()=>a(1933));module.exports=o})();